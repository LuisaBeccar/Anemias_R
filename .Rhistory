geom_text(aes(label = value), position = position_stack(vjust = 0.5)) # Add value labels
# Create the pie chart
ggplot(tipo, aes(x = "tipo", y = consultas, fill = tipo)) +
geom_bar(width = 1, stat = "identity", color = "white") + # Create a stacked bar chart
coord_polar("y", start = 0) + # Convert to polar coordinates
theme_void() + # Remove background, grid, and axis labels
labs(title = "City pie chart") + # Add a title
geom_text(aes(label = consultas), position = position_stack(vjust = 0.5)) # Add value labels
# Create the pie chart
ggplot(tipo, aes(x = "tipo", y = consultas, fill = tipo)) +
geom_bar(width = 1, stat = "identity", color = "white") + # Create a stacked bar chart
coord_polar("y", start = 0) + # Convert to polar coordinates
theme_void() + # Remove background, grid, and axis labels
labs(title = "Tipos de consulta") + # Add a title
geom_text(aes(label = consultas), position = position_stack(vjust = 0.2)) # Add value labels
# Create the pie chart
ggplot(tipo, aes(x = "tipo", y = consultas, fill = tipo)) +
geom_bar(width = 1, stat = "identity", color = "white") + # Create a stacked bar chart
coord_polar("y", start = 0) + # Convert to polar coordinates
theme_void() + # Remove background, grid, and axis labels
labs(title = "Tipos de consulta") + # Add a title
geom_text(aes(label = consultas), position = position_stack(vjust = 0.9)) # Add value labels
# Create the pie chart
ggplot(tipo, aes(x = "tipo", y = consultas, fill = tipo)) +
geom_bar(width = 1, stat = "identity", color = "white") + # Create a stacked bar chart
coord_polar("y", start = 0) + # Convert to polar coordinates
theme_void() + # Remove background, grid, and axis labels
labs(title = "Tipos de consulta") + # Add a title
geom_text(aes(label = consultas), position = position_stack(vjust = 0.5)) # Add value labels
# Create the pie chart
ggplot(tipo, aes(x = "tipo", y = consultas, fill = tipo)) +
geom_bar(width = 1, stat = "identity", color = "white") + # Create a stacked bar chart
coord_polar("y", start = 0) + # Convert to polar coordinates
theme_void() + # Remove background, grid, and axis labels
labs(title = "Tipos de consulta") +
# Usamos geom_text_repel en lugar de geom_text
geom_text_repel(
aes(label = paste0(tipo, ": ", consultas)),
position = position_stack(vjust = 0.5),
size = 4,
box.padding = 0.5,      # Espacio alrededor de la etiqueta
point.padding = 0.5,    # Espacio entre el punto y la etiqueta
nudge_x = 0.6,          # Empuja las etiquetas hacia afuera del centro
show.legend = FALSE
)
library(ggrepel) # Librería necesaria para etiquetas inteligentes
# Create the pie chart
ggplot(tipo, aes(x = "tipo", y = consultas, fill = tipo)) +
geom_bar(width = 1, stat = "identity", color = "white") + # Create a stacked bar chart
coord_polar("y", start = 0) + # Convert to polar coordinates
theme_void() + # Remove background, grid, and axis labels
labs(title = "Tipos de consulta") +
# Usamos geom_text_repel en lugar de geom_text
geom_text_repel(
aes(label = paste0(tipo, ": ", consultas)),
position = position_stack(vjust = 0.5),
size = 4,
box.padding = 0.5,      # Espacio alrededor de la etiqueta
point.padding = 0.5,    # Espacio entre el punto y la etiqueta
nudge_x = 0.6,          # Empuja las etiquetas hacia afuera del centro
show.legend = FALSE
)
install.packages("ggrepel")
library(ggrepel) # Librería necesaria para etiquetas inteligentes
# Create the pie chart
ggplot(tipo, aes(x = "tipo", y = consultas, fill = tipo)) +
geom_bar(width = 1, stat = "identity", color = "white") + # Create a stacked bar chart
coord_polar("y", start = 0) + # Convert to polar coordinates
theme_void() + # Remove background, grid, and axis labels
labs(title = "Tipos de consulta") +
# Usamos geom_text_repel en lugar de geom_text
geom_text_repel(
aes(label = paste0(tipo, ": ", consultas)),
position = position_stack(vjust = 0.5),
size = 4,
box.padding = 0.5,      # Espacio alrededor de la etiqueta
point.padding = 0.5,    # Espacio entre el punto y la etiqueta
nudge_x = 0.6,          # Empuja las etiquetas hacia afuera del centro
show.legend = FALSE
)
# 1. Preparamos los datos calculando la posición central de cada porción
data_plot <- tipo %>%
arrange(desc(tipo)) %>%
mutate(prop = consultas / sum(tipo$consultas) * 100) %>%
mutate(ypos = cumsum(consultas) - 0.5 * consultas)
data_plot <- tipo %>%
arrange(desc(tipo)) %>%
mutate(prop = consultas / sum(tipo$consultas) * 100) %>%
mutate(ypos = cumsum(consultas) - 0.5 * consultas)
# 1. Preparamos los datos calculando la posición central de cada porción
data_plot <- tipo %>%
arrange(desc(consultas)) %>%
mutate(prop = consultas / sum(tipo$consultas) * 100) %>%
mutate(ypos = cumsum(consultas) - 0.5 * consultas)
data_plot <- tipo %>%
arrange(desc(consultas)) %>%
mutate(prop = consultas / sum(tipo$consultas) * 100) %>%
mutate(ypos = cumsum(consultas) - 0.5 * consultas)
library(googlesheets4)
library(lubridate)
library(tidyverse)
library(tidyr)
library(dplyr)
library(kableExtra)
library(blastula) # para mandar el mail
library(keyring)
library(janitor)
library(ggplot2)
library(ggrepel) # Librería necesaria para etiquetas inteligentes
# Replace URL with your actual Google Sheet link
#Authorize Access:  The first time you run this, a browser window will open. Select your Google account and grant R permission to access your spreadsheets.
central_0 <- read_sheet("https://docs.google.com/spreadsheets/d/1yyGZ1AKNuqTzpXRwkhkZ99uRKT7C-xSayzUmntLvwaY/edit?usp=sharing", sheet = "Central")
central_1 <- central_0 %>%
# nombre de columnas todo minuscula con _ en espacios
clean_names() %>%
select(-nombre_y_apellido, -dia, -mes, -ano, -rex_ex, -detalle_procedencia,
-diagnostico_y_detalle_del_mismo, - terapeutica, -instituciones,
-antecedentes_personales) %>%
# renombro algunas mas corto
rename(planilla = planilla_de_accidente,
negativa = negativa_de_atencion,
derivacion = detalles_de_derivacion) %>%
# quito las filas con alguna de estas variables importantes vacias
drop_na(fecha,hora,sexo,edad,procedencia,motivo,tipo,planilla,negativa)
###### PERÍODO
# unit: second, minute, hour, day, week, month, bimonth, quarter, season, halfyear, year
# Fecha fin: El último día del mes anterior a hoy
fecha_fin <- rollback(floor_date(today(), unit = "month", week_start = 2))
# Fecha inicio: El primer día de ese mismo mes
fecha_inicio <- floor_date(fecha_fin, unit =  "month")
#print(paste("Desde:", fecha_inicio, "Hasta:", fecha_fin))
# ejemplo: hoy 28 diciembre 2025 me tira...
# month: todo noviembre: desde 1/11/25 a 30/11/25
# halfyear: me tira todo lo de la ultima helf year completo que fue la primera mitad de año 2025: 1/1 a 30/12
# quarter: el tercer tercio del año: de julio a fin de septiembre
# season: de septiembre a fin de noviembre ??
# bimonth: bimestre de septiembre-octubre
#
####
central_mes_pasado <- central_1 %>%
filter(fecha >= fecha_inicio & fecha <= fecha_fin)
### tablas
#----- tipo de consulta
tipo <- central_mes_pasado %>%
group_by(tipo) %>%
summarise(consultas = n()) %>%
arrange(desc(consultas))
k_tipo <- kable(motivo) %>%
kable_styling(bootstrap_options = "striped")
k_tipo <- kable(tipo) %>%
kable_styling(bootstrap_options = "striped")
k_tipo
#------ tipo de consulta segun motivo
motivo_tipo <- central_mes_pasado %>%
group_by(tipo, motivo) %>%
summarise(consultas = n(), .groups = "drop") %>%
# Creamos una columna temporal con el total de cada Tipo para poder ordenar
group_by(tipo) %>%
mutate(total_tipo = sum(consultas)) %>%
ungroup() %>%
# Ordenamos: 1º por el subtotal del Tipo, 2º por las consultas del Motivo
arrange(desc(total_tipo), tipo, desc(consultas)) %>%
select(tipo, motivo, consultas)
k_motivo_tipo <- kable(motivo_tipo) %>%
collapse_rows(columns = 1,
valign = "top") %>%
kable_styling(bootstrap_options = "striped")
k_motivo_tipo
# 2. Crear el cuerpo del correo con la tabla
email_body <- compose_email(body = md(c("Adjunto el reporte de Motivos de consulta del mes anterior",
k_motivo,
k_motivo_tipo))) # Inserta la tabla directamente
# 2. Crear el cuerpo del correo con la tabla
email_body <- compose_email(body = md(c("Adjunto el reporte de Motivos de consulta del mes anterior",
k_tipo,
k_motivo_tipo))) # Inserta la tabla directamente
email_body
?md
# 2. Crear el cuerpo del correo con la tabla
email_body <- compose_email(body = md(c("Adjunto el reporte de Motivos de consulta del mes anterior",
k_tipo, '/n',
k_motivo_tipo))) # Inserta la tabla directamente
email_body
# 2. Crear el cuerpo del correo con la tabla
email_body <- compose_email(body = md(c("Adjunto el reporte de Motivos de consulta del mes anterior",
k_tipo, "/n",
k_motivo_tipo))) # Inserta la tabla directamente
email_body
# 2. Crear el cuerpo del correo con la tabla
email_body <- compose_email(body = md(c("Adjunto el reporte de Motivos de consulta del mes anterior",
k_tipo, /n,
# 2. Crear el cuerpo del correo con la tabla
email_body <- compose_email(body = md(c("Adjunto el reporte de Motivos de consulta del mes anterior",
k_tipo '/n',
# 2. Crear el cuerpo del correo con la tabla
email_body <- compose_email(body = md(c("Adjunto el reporte de Motivos de consulta del mes anterior",
k_tipo,
' /n ',
k_motivo_tipo))) # Inserta la tabla directamente
email_body
# 2. Crear el cuerpo del correo con la tabla
email_body <- compose_email(body = md(c("Adjunto el reporte de Motivos de consulta del mes anterior",
k_tipo,
' //n ',
k_motivo_tipo))) # Inserta la tabla directamente
email_body
# 2. Crear el cuerpo del correo con la tabla
email_body <- compose_email(body = md(c("Adjunto el reporte de Motivos de consulta del mes anterior",
k_tipo,
' ',
k_motivo_tipo))) # Inserta la tabla directamente
email_body
motivo_tipo <- central_mes_pasado %>%
group_by(tipo, motivo) %>%
summarise(consultas = n(), .groups = "drop") %>%
# Creamos una columna temporal con el total de cada Tipo para poder ordenar
group_by(tipo) %>%
mutate(total_tipo = sum(consultas)) %>%
ungroup() %>%
# Ordenamos: 1º por el subtotal del Tipo, 2º por las consultas del Motivo
arrange(desc(total_tipo), tipo, desc(consultas)) %>%
select(tipo, motivo, consultas)
k_motivo_tipo <- kable(motivo_tipo, format = "html") %>%
collapse_rows(columns = 1,
valign = "top") %>%
kable_styling(bootstrap_options = "striped")
k_motivo_tipo
# 2. Crear el cuerpo del correo con la tabla
email_body <- compose_email(body = md(c("Adjunto el reporte de Motivos de consulta del mes anterior<br><br>",
k_tipo,
'<br><br> ',
k_motivo_tipo))) # Inserta la tabla directamente
email_body
k_tipo <- kable(tipo, format = "html") %>%
kable_styling(bootstrap_options = "striped") %>%
col.names=c("Tipo", "Cantidad de conusltas")
k_tipo
k_tipo <- kable(tipo, col.names = c("Tipo", "Cantidad de conusltas"), format = "html") %>%
kable_styling(bootstrap_options = "striped")
k_tipo
k_motivo_tipo <- kable(motivo_tipo,col.names = c("Motivo", "Cantidad de conusltas"), format = "html") %>%
collapse_rows(columns = 1,
valign = "top") %>%
kable_styling(bootstrap_options = "striped")
k_motivo_tipo <- kable(motivo_tipo, col.names = c("Tipo", "Motivo", "Cantidad de conusltas"), format = "html") %>%
collapse_rows(columns = 1,
valign = "top") %>%
kable_styling(bootstrap_options = "striped")
k_motivo_tipo
# 2. Crear el cuerpo del correo con la tabla
email_body <- compose_email(body = md(c("Adjunto el reporte de Motivos de consulta del mes anterior<br><br>",
print(paste("Desde:", fecha_inicio, "Hasta:", fecha_fin)),
k_tipo,
'<br><br> ',
k_motivo_tipo))) # Inserta la tabla directamente
# 2. Crear el cuerpo del correo con la tabla
email_body <- compose_email(body = md(c("Adjunto el reporte de Motivos de consulta del mes anterior<br><br>",
paste("Desde:", fecha_inicio, "Hasta:", fecha_fin),
k_tipo,
'<br><br> ',
k_motivo_tipo))) # Inserta la tabla directamente
email_body
# 2. Crear el cuerpo del correo con la tabla
email_body <- compose_email(body = md(c("Adjunto el reporte del período ", fecha_inicio, " hasta: ", fecha_fin),"<br><br>",
k_tipo,
'<br><br> ',
k_motivo_tipo))# Inserta la tabla directamente
email_body
k_motivo_tipo))# Inserta la tabla directamente
k_motivo_tipo))# Inserta la tabla directamente
# 2. Crear el cuerpo del correo con la tabla
email_body <- compose_email(body = md(c("Adjunto el reporte del período ", fecha_inicio, " hasta: ", fecha_fin,"<br><br>",
k_tipo,
'<br><br> ',
k_motivo_tipo)))# Inserta la tabla directamente
email_body
email_body <- compose_email(body = md(c(paste("Adjunto el reporte del período desde:", fecha_inicio, "hasta:", fecha_fin),"<br><br>",
k_tipo,
'<br><br> ',
k_motivo_tipo)))# Inserta la tabla directamente
email_body
k_tipo <- kable(tipo, col.names = c("Tipo", "Cantidad de conusltas"), format = "html") %>%
kable_styling(bootstrap_options = "striped", stripe_color = "gray!10")
k_tipo
# 2. Crear el cuerpo del correo con la tabla
email_body <- compose_email(body = md(c(paste("Adjunto el reporte del período desde:", fecha_inicio, "hasta:", fecha_fin),"<br><br>",
k_tipo,
'<br><br> ',
k_motivo_tipo)))# Inserta la tabla directamente
email_body
k_tipo <- kable(tipo, col.names = c("Tipo", "Cantidad de conusltas"), format = "html") %>%
kable_styling(bootstrap_options = "striped", protect_latex = TRUE )
k_tipo
# 2. Crear el cuerpo del correo con la tabla
email_body <- compose_email(body = md(c(paste("Adjunto el reporte del período desde:", fecha_inicio, "hasta:", fecha_fin),"<br><br>",
k_tipo,
'<br><br> ',
k_motivo_tipo)))# Inserta la tabla directamente
email_body
k_tipo <- kable(tipo, col.names = c("Tipo", "Cantidad de conusltas"), format = "html",
# Esto fuerza el borde exterior básico que entienden todos los correos
table.attr = "style='border: 1px solid black; border-collapse: collapse;'") %>%
kable_classic(full_width = F, html_font = "Arial") %>%
kable_styling(bootstrap_options = c("striped", "bordered")) %>%
# Forzamos bordes en las celdas manualmente para máxima compatibilidad
column_spec(1:2, border_left = "1px solid #ddd", border_right = "1px solid #ddd")
# ) %>%
#   kable_styling(bootstrap_options = "striped", protect_latex = TRUE )
k_tipo
# 2. Crear el cuerpo del correo con la tabla
email_body <- compose_email(body = md(c(paste("Adjunto el reporte del período desde:", fecha_inicio, "hasta:", fecha_fin),"<br><br>",
k_tipo,
'<br><br> ',
k_motivo_tipo)))
email_body
k_tipo <- kable(tipo, col.names = c("Tipo", "Cantidad de conusltas"), format = "html",
# Esto fuerza el borde exterior básico que entienden todos los correos
table.attr = "style='border: 1px solid black; border-collapse: collapse;'") %>%
kable_classic(full_width = F, html_font = "Arial") %>%
kable_styling(bootstrap_options = c("striped", "bordered")) %>%
# Forzamos bordes en las celdas manualmente para máxima compatibilidad
column_spec(1:2, border_left = "1px solid #ddd", border_right = "1px solid #ddd") %>%
# Aplicamos borde inferior a todas las filas (desde la 0, que es el encabezado, hasta la última)
row_spec(0:nrow(tipo), extra_css = "border-bottom: 1px solid #cccccc;") %>%
# Opcional: poner el encabezado en negrita y con un fondo gris claro
row_spec(0, bold = TRUE, background = "#f2f2f2")
# ) %>%
#   kable_styling(bootstrap_options = "striped", protect_latex = TRUE )
k_tipo
# 2. Crear el cuerpo del correo con la tabla
email_body <- compose_email(body = md(c(paste("Adjunto el reporte del período desde:", fecha_inicio, "hasta:", fecha_fin),"<br><br>",
k_tipo,
'<br><br> ',
k_motivo_tipo)))
email_body
k_motivo_tipo <- kable(motivo_tipo,
col.names = c("Tipo", "Motivo", "Cantidad de consultas"),
format = "html",
# Estilo base de la tabla
table.attr = "style='border: 1px solid black; border-collapse: collapse; width: 100%;'") %>%
# Colapsamos la primera columna (Tipo)
collapse_rows(columns = 1, valign = "top") %>%
# Tema clásico para compatibilidad con emails
kable_classic(full_width = F, html_font = "Arial") %>%
kable_styling(bootstrap_options = c("striped", "bordered")) %>%
# Forzamos bordes laterales en las 3 columnas
column_spec(1:3, border_left = "1px solid #ddd", border_right = "1px solid #ddd") %>%
# Bordes inferiores en todas las filas para separar motivos
row_spec(0:nrow(motivo_tipo), extra_css = "border-bottom: 1px solid #cccccc;") %>%
# Encabezado consistente con la tabla anterior
row_spec(0, bold = TRUE, background = "#f2f2f2")
k_motivo_tipo <- kable(motivo_tipo,
col.names = c("Tipo", "Motivo", "Cantidad de consultas"),
format = "html",
# Estilo base de la tabla
table.attr = "style='border: 1px solid black; border-collapse: collapse; width: 100%;'") %>%
# Colapsamos la primera columna (Tipo)
collapse_rows(columns = 1, valign = "top") %>%
# Tema clásico para compatibilidad con emails
kable_classic(full_width = F, html_font = "Arial") %>%
kable_styling(bootstrap_options = c("striped", "bordered")) %>%
# Forzamos bordes laterales en las 3 columnas
column_spec(1:3, border_left = "1px solid #ddd", border_right = "1px solid #ddd") %>%
# Bordes inferiores en todas las filas para separar motivos
row_spec(0:nrow(motivo_tipo), extra_css = "border-bottom: 1px solid #cccccc;") %>%
# Encabezado consistente con la tabla anterior
row_spec(0, bold = TRUE, background = "#f2f2f2")
k_motivo_tipo <- kable(motivo_tipo,
col.names = c("Tipo", "Motivo", "Cantidad de consultas"),
format = "html",
table.attr = "style='border: 1px solid black; border-collapse: collapse; width: 100%;'") %>%
kable_classic(full_width = F, html_font = "Arial") %>%
kable_styling(bootstrap_options = c("striped", "bordered")) %>%
# 1. Aplicamos bordes y estilos ANTES de colapsar
column_spec(1:3, border_left = "1px solid #ddd", border_right = "1px solid #ddd") %>%
row_spec(0:nrow(motivo_tipo), extra_css = "border-bottom: 1px solid #cccccc;") %>%
row_spec(0, bold = TRUE, background = "#f2f2f2") %>%
# 2. COLAPSAR al final para que no rompa las funciones anteriores
collapse_rows(columns = 1, valign = "top")
k_motivo_tipo
email_body <- compose_email(body = md(c(paste("Adjunto el reporte del período desde:", fecha_inicio, "hasta:", fecha_fin),"<br><br>",
k_tipo,
'<br><br> ',
k_motivo_tipo)))
email_body
View(email_body)
cuerpo = c(paste("Adjunto el reporte del período desde:",
fecha_inicio, "hasta:",
fecha_fin),
"<br><br>",
k_tipo,
'<br><br> ',
k_motivo_tipo)
destinatario <- luisabeccarvarela@gmail.com # Elegir destinatario
texto <- "Hola, Adjunto el Reporte de CDA" # Texto del correo
psw <- "harrypotter72"
send.mail(from = "luisabeccarvarela2@gmail.com",
to = destinatario,
subject = "Reporte del mes pasado",
body = cuerpo,
smtp = list(host.name = "smtp.gmail.com",
port = 465,
user.name = "luisabeccarvarela2@gmail.com",
passwd = psw,
ssl = TRUE),
authenticate = TRUE,
send = TRUE,      # Autorizar envío de correo
#attach.files = nombre
)
install.packages("mailR")
send.mail(from = "luisabeccarvarela2@gmail.com",
to = destinatario,
subject = "Reporte del mes pasado",
body = cuerpo,
smtp = list(host.name = "smtp.gmail.com",
port = 465,
user.name = "luisabeccarvarela2@gmail.com",
passwd = psw,
ssl = TRUE),
authenticate = TRUE,
send = TRUE,      # Autorizar envío de correo
#attach.files = nombre
)
send.mail(from = "luisabeccarvarela2@gmail.com",
to = destinatario,
subject = "Reporte del mes pasado",
body = cuerpo,
smtp = list(host.name = "smtp.gmail.com",
port = 465,
user.name = "luisabeccarvarela2@gmail.com",
passwd = psw,
ssl = TRUE),
authenticate = TRUE,
send = TRUE,      # Autorizar envío de correo
#attach.files = nombre
)
################### INDICAICONES ############################
# CORRER SOLO SI YA SE CORRIO ANEMIAS1 O ANEMIAS_FROM_PENDRIVE,
# QUE HAYAN GENERADO EL ARCHIVO EVAL_PACIENTES_INC.CSV, SE HAYA SUBIDO A DRIVE,
# UNA PERSONA HAYA PUESTO M O F EN AQUELLOS QUE TIENEN ESTADO = "Si sexo = masculino --> Excluir, Si femenino --> Incluir",
# SE HAYA DESCARGADO ESE ARCHIVO EVALUADO Y SUBIDO A LA CARPETA DEL PROYECTO EN R,
# AHORA CON EL NOMBRE DE "eval_pacientes_inc - eval_pacientes_inc.csv".
##############################################################
# lo que hace este codigo es tomar ese archivo, leer los pacientes que tenian que ser evaluados,
# si son hombres con hb menor a 13 les da el estado de Excluidos por anemia basal,
# y reescribimos la tabla con esos estados, con más excluidos.
# luego se evalua de nuevo cuales son los incluidos y excluidos y se mueven los archivos
# de los pacientes que deben ser excluidos a la carpeta de Excluidos (subcarpeta dentro de Pacientes)
# al finalizar esta tarea, elimina las tablas intermedias "eval_pacientes_inc", "eval_pacientes_inc - eval_pacientes_inc.csv" y
# nombra a la nueva tabla, que fue ademas modificada en cuanto a sus columnas como reevaluado.csv
###############################################################
library(tidyverse)
library(readr)
library(readxl)
library(dplyr)
library(tidyr)
library(stringr)
library(lubridate)
# 1. Configuración de rutas
setwd("~/R Studio/PaulaAnemias")
path_pacientes <- "Pacientes"
path_excluidos <- file.path(path_pacientes, "Excluidos")
if (!dir.exists(path_excluidos)) dir.create(path_excluidos)
# 2. Leer y validar por sexo/hemoglobina
# (Nota: Asegúrate de que 'sexo' y 'hb_inicial' estén en el CSV o se unan aquí)
evaluado <- read_csv("eval_pacientes_inc - eval_pacientes_inc.csv") %>%
mutate(estado = if_else(
sexo == "M" & estado == "Si sexo = masculino --> Excluir, Si femenino --> Incluir",
paste0("EXCLUIDO - Anemia basal: ", hb_inicial),
estado
)) %>%
relocate(estado, .after = last_col())
# 3. Mover archivos que no tengan estado "Incluir"
archivos_a_excluir <- evaluado %>%
filter(estado != "Incluir") %>%
pull(archivo)
for (f in archivos_a_excluir) {
ruta_origen <- file.path(path_pacientes, f)
ruta_destino <- file.path(path_excluidos, f)
if (file.exists(ruta_origen)) {
file.rename(from = ruta_origen, to = ruta_destino)
message(paste("Movido a Excluidos:", f))
}
}
# 4. Guardar reporte final
write_csv(evaluado, "reevaluado.csv")
# 5. Eliminar temporales viejos
archivos_transitorios <- c("eval_pacientes_inc.csv","eval_pacientes_inc - eval_pacientes_inc.csv" )
if (file.exists(tabla_seguimiento)) {
existentes <- archivos_transitorios[file.exists(archivos_transitorios)]
if (length(existentes) > 0) {
file.remove(as.character(existentes))
message("Limpieza de archivos transitorios completada.")
}
} else {
stop("No se encontró reevaluado.csv. No se borraron los temporales.")
}
View(evaluado)
# 4. Guardar reporte final
tabla_seguimiento <- "reevaluado.csv" # conservar: abajo usa la variable tabla seguimiento
write_csv(evaluado, tabla_seguimiento)
# 5. Eliminar temporales viejos
archivos_transitorios <- c("eval_pacientes_inc.csv","eval_pacientes_inc - eval_pacientes_inc.csv" )
if (file.exists(tabla_seguimiento)) {
existentes <- archivos_transitorios[file.exists(archivos_transitorios)]
if (length(existentes) > 0) {
file.remove(as.character(existentes))
message("Limpieza de archivos transitorios completada.")
}
} else {
stop("No se encontró reevaluado.csv. No se borraron los temporales.")
}
